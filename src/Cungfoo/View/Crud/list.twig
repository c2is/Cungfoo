{% extends 'base.twig' %}

{% block javascripts %}{{ parent() }}
    <script type="text/javascript" src="{{ asset('js/cungfoo/confirm-bootstrap.js') }}"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('#list .line').bind('dblclick', function () {
                console.log($('.edit', this).attr('href'));
                window.location.href = $('.edit', this).attr('href');
            });

            $('.active').bind('click', function() {
                var $this = $(this);

                $.get($this.attr('href'), function(data) {
                    var $icon = $('i', $this).removeClass();
                    var $line = $this.parent('td').parent('tr');

                    if (data.active) {
                        $icon.addClass('icon-eye-open');
                        $line.removeClass('disabled');
                    }
                    else {
                        $icon.addClass('icon-eye-close');
                        $line.addClass('disabled');
                    }
                });

                return false;
            })
        });
    </script>
{% endblock %}

{% block content %}
    <div class="btn-group pull-right">
        <a class="btn add" href="{{ path('%s_crud_create' | format (name)) }}"><i class="icon-plus"></i> {{ "crud.button.add" | trans }}</a>
    </div>
    <h1>{{ (name ~ ".crud.list") | trans }}</h1>
    <hr />
    <div class="row">
        <div class="span8">{{ context | raw }}</div>
        <div class="span4">
            {% if (paginator.nextPage != paginator.page or paginator.previousPage != paginator.page) and lines | length != 0 %}
            {% include 'Crud/paginator.twig'%}
            {% endif %}
        </div>
    </div>
    <table id="list" class="table table-striped ">
        <thead>
        <tr>
            {% for column_name in column_names %}
            {% if column_name != name ~ ".active" %}
                <th>{{ column_name | trans }}</th>
            {% endif %}
            {% endfor %}
            <th class="actions-item" colspan="3">{{ 'list.actions' | trans }}</th>
        </tr>
        </thead>
        <tbody>
        {% for line in lines %}
        <tr class="line{% if line.active != true %} disabled{% endif %}">
            {% for column_name,column in line %}
            {% if column_name != "active" %}
                <td>{{ column | raw }}</td>
            {% endif %}
            {% endfor %}
            <td class="actions-item"><a class="edit" href="{{ path('%s_crud_update' | format (name), {'id': line.id}) }}"><i class="icon-edit"></i></a></td>
            <td class="actions-item"><a class="delete" href="{{ path('%s_crud_delete' | format (name), {'id': line.id}) }}"><i data-confirm-ok="{{ "crud.modal.delete.ok" | trans }}" data-confirm-cancel="{{ "crud.modal.delete.cancel" | trans }}" data-confirm-title="{{ "crud.modal.delete.title" | trans }}" data-confirm-message="{{ "crud.modal.delete.message" | trans  ({'%code%': line.id }) }}"  class="icon-remove-circle"></i></a></td>
            <td class="actions-item"><a class="active" href="{{ path('%s_crud_active' | format (name), {'id': line.id}) }}"><i class="icon-eye-{% if line.active %}open{% else %}close{% endif %}"></i></a></td>
        </tr>
        {% endfor %}
        </tbody>
    </table>

    <script type="text/javascript">
        $('.actions-item .delete').confirmModal();
    </script>
    {% if (paginator.nextPage != paginator.page or paginator.previousPage != paginator.page) and lines | length != 0 %}
    {% include 'Crud/paginator.twig'%}
    {% endif %}
{% endblock %}
