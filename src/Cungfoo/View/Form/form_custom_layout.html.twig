{% use 'form_div_layout.html.twig' %}

{% block textrich_widget %}
<link rel="stylesheet" href="{{ asset('vendor/redactor/css/redactor.css') }}">
<script src="{{ asset('vendor/redactor/redactor.js') }}"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $('#{{ id }}').redactor();
    });
</script>
{% spaceless %}
<textarea {{ block('widget_attributes') }}>{{ value }}</textarea>
{% endspaceless %}
{% endblock %}

{% block translation_collection_widget %}
<div class="tabbable">
    <ul class="nav nav-tabs">
        {% for child in form %}
            {% if not child.rendered %}
            <li class="{% if loop.first %}active{% endif %}"><a href="#{{ child.vars.value.locale }}" data-toggle="tab"><img src="{{ asset('images/cungfoo/flags/' ~ child.vars.value.locale ~ '.gif') }}" /></a></li>
            {% endif %}
        {% endfor %}
    </ul>
    <div class="tab-content">
        {% for child in form %}
            {% if not child.rendered %}
            <div class="tab-pane {% if loop.first %}active{% endif %}" id="{{ child.vars.value.locale }}">
                {{ form_widget(child) }}
            </div>
            {% endif %}
        {% endfor %}
    </div>
</div>
{% endblock %}

{% block cungfoo_file_widget %}
{% spaceless %}
{% if value %}
<a href="{{ asset(value) }}"><img class="thumbnail" src="{{ asset(value) }}" style="max-width: 128px"/></a>
{% endif %}
{{ block('form_widget_simple') }}
{% endspaceless %}
{% endblock %}

{% block date_widget %}
{% spaceless %}
<div class="input-append widget-datepicker date" {% if value is not empty %}data-date="{{ value }}" {% endif %} data-date-format="yyyy-mm-dd">
    <input type="text" {{ block('widget_attributes') }} {% if value is not empty %}value="{{ value }}" {% endif %}>
    <span class="add-on"><i class="icon-th"></i></span>
</div>
<script type="text/javascript">
    $(function () {
        $('.widget-datepicker').datepicker();
    });
</script>
{% endspaceless %}
{% endblock %}

{% block form_widget %}
    {% if 'groups' in form.get('attr')|keys %}
        <ul id="crudGroup" class="nav nav-tabs">
        {% for group in form.get('attr').groups %}
            <li class=""><a href="#{{ group.title | replace({'.': ''})}}">{{ group.title | trans }}</a></li>
        {% endfor %}
        </ul>

        <div id="crudGroupContent" class="tab-content">
        {{ form_errors(form) }}
        {% for group in form.get('attr').groups %}

            {% if group.columns is defined %}
                {% set columns = group.columns %}
            {% else %}
                {% set columns = 1 %}
            {% endif %}

            <div class="tab-pane row" id="{{ group.title | replace({'.': ''})}}">
            {% if group.content is defined %}
                {% if group.description is defined %}
                <blockquote>{{ group.description }}</blockquote>
                {% endif %}
                {% for row in group.content %}
                    <div class="span{{ 12 / columns }}">
                        {{ form_row(form[row]) }}
                    </div>
                {% endfor %}
            {% endif %}
            </div>
        {% endfor %}
        </div>

        <div style="display: none">
        {{ form_rest(form) }}
        </div>

        <script>
            $(function () {
                $('#crudGroup a').click(function (e) {
                    e.preventDefault();
                    $(this).tab('show');
                });

                $('#crudGroup a:first').tab('show');
            });
        </script>
    {% else %}
        {{ parent() }}
    {% endif %}
{% endblock %}

{% block form_widget_compound %}
{% spaceless %}
    <div {{ block('widget_container_attributes') }} class="row">
        {% if form.parent is empty %}
            {{ form_errors(form) }}
        {% endif %}
        {{ block('form_rows') }}
        {{ form_rest(form) }}
    </div>
{% endspaceless %}
{% endblock form_widget_compound %}

{% block form_rows %}
{% spaceless %}
    {% set index = 1 %}
    {% for child in form %}
        {% if 'hidden' in child.vars.block_prefixes %}
            {{ form_row(child) }}
        {% else %}
            {% if index is not divisibleby(2) %}
            <div class="span12">
            <div class="row">
            {% endif %}
            {{ form_row(child) }}
            {% if index is divisibleby(2) or loop.last %}
            </div>
            </div>
            {% endif %}

            {% set index = index + 1 %}
        {% endif %}

    {% endfor %}
{% endspaceless %}
{% endblock form_rows %}

{% block form_row %}
{% spaceless %}
    <div class="span{% if 'I18ns' in form.vars.id and 'I18ns_' not in form.vars.id or 'textarea' in form.vars.block_prefixes %}12{% else %}6{% endif %}">
        {{ form_label(form) }}
        {{ form_errors(form) }}
        {{ form_widget(form) }}
    </div>
{% endspaceless %}
{% endblock form_row %}
